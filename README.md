# Currency

[![Build Status](https://travis-ci.org/portmare/currency.svg?branch=master)](https://travis-ci.org/portmare/currency)

## Описание

Приложение для отображения периодически обновляемого курса валюты, и с возможностью установки форсированного курса валюты до определенного времени.

Текущий курс валют запрашивается с сайта [CBR](https://www.cbr.ru/development/DWS/), используя протокол `SOAP`. 
Само обновление в браузере клиента осуществляется через `Websocket` (`ActionCable`) из фоновой задачи (`Sidekiq`).
За периодичность отвечает cron.

## Режим development

Перед запуском необходимо убедиться, что в локальной системе присутствуют следующие зависимости:

- Ruby 2.3+
- PostgreSQL 9.5+
- Redis 3.2

Перед первым запуском приложения в режиме `development` необходимо выполнить:
```
$ bundle install
$ rake db:create; rake db:migrate
$ whenever --update-crontab --set environment=development
```
Команда добавит в cron ежеминутную задачу обновления курса.

## Запуск приложения в режиме development

Для запуска приложения необходимо воспользоваться `foreman` со следующими параметрами:
```
$ foreman start -f Procfile.dev
```

## Масштабируемость приложения

В модели `ExchangeRate`, используемую для форсированного курса, прописана только одна валюта: американский доллар `USD` в перечислении:
```ruby
class ExchangeRate < ApplicationRecord
  enum currency: { usd: 'usd' }
end
```
Для того, чтобы добавить или изменить валюту, достаточно прописать в данном перечислении коды желаемых валют, которые можно получить с сайта [CBR](http://www.cbr.ru/scripts/XML_valFull.asp). 

## Существующие ограничения

* На странице `/admin` возможно вводить только положительный курс валюты.

* На странице `/admin` нельзя указать секунды для уточнения окончания форсированного курса, в следствие ограниченности выбранного компонента `Vue`.

* На странице `/admin` поля курса валюты и времени его окончания являются обязательными для ввода.

## Heroku

Приложение выложено на сервер `Heroku` и доступно по адресу: https://portmare-currency.herokuapp.com. 
